---
phase: 01-offline-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/shared/ipc-channels.ts
  - src/shared/ipc-types.ts
autonomous: true
requirements:
  - OFFL-01
  - OFFL-02
  - OFFL-03
  - OFFL-04

must_haves:
  truths:
    - "GET_CACHED_USAGE channel constant exists in ipc-channels.ts"
    - "CachedUsageData interface is exported from ipc-types.ts with data and timestamp fields"
    - "ElectronAPI interface includes getCachedUsage method returning Promise<CachedUsageData | null>"
  artifacts:
    - path: "src/shared/ipc-channels.ts"
      provides: "GET_CACHED_USAGE channel constant"
      contains: "get-cached-usage"
    - path: "src/shared/ipc-types.ts"
      provides: "CachedUsageData interface and getCachedUsage in ElectronAPI"
      exports: ["CachedUsageData"]
  key_links:
    - from: "src/shared/ipc-channels.ts"
      to: "src/main/main.ts"
      via: "IpcChannels.GET_CACHED_USAGE used in ipcMain.handle"
      pattern: "GET_CACHED_USAGE"
    - from: "src/shared/ipc-types.ts"
      to: "src/renderer/app.ts"
      via: "CachedUsageData type used in offline fallback"
      pattern: "CachedUsageData"
---

<objective>
Establish the shared IPC contract for the offline cache feature: add the GET_CACHED_USAGE channel constant and CachedUsageData type so main process, preload, and renderer can all reference the same definitions.

Purpose: All offline mode work in Plans 02 and 03 depends on this shared contract existing first. This plan creates the foundation.
Output: Updated ipc-channels.ts with new channel constant; updated ipc-types.ts with CachedUsageData interface and ElectronAPI method signature.
</objective>

<execution_context>
@/Users/jamesbolton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jamesbolton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/shared/ipc-channels.ts
@src/shared/ipc-types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GET_CACHED_USAGE channel to ipc-channels.ts</name>
  <files>src/shared/ipc-channels.ts</files>
  <action>
    Add `GET_CACHED_USAGE: 'get-cached-usage'` to the IpcChannels object, in the invoke section (renderer -> main, returns promise). Place it after the existing `SET_REFRESH_INTERVAL` entry to keep it grouped with other invoke channels.

    The IpcChannels object is exported as `as const` — maintain that pattern. Do not change any existing entries.

    Result: IpcChannels.GET_CACHED_USAGE === 'get-cached-usage'
  </action>
  <verify>Run `npm run typecheck` from /Users/jamesbolton/Documents/GIT/claude-usage-widget — must pass with zero errors.</verify>
  <done>IpcChannels.GET_CACHED_USAGE exists and equals 'get-cached-usage'; typecheck passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add CachedUsageData interface and getCachedUsage to ipc-types.ts</name>
  <files>src/shared/ipc-types.ts</files>
  <action>
    Make two additions to ipc-types.ts:

    1. Add `CachedUsageData` interface after the `UsageData` interface definition:
    ```typescript
    export interface CachedUsageData {
      data: UsageData
      timestamp: number  // Unix ms — when live data was last fetched from the API
    }
    ```

    2. Add `getCachedUsage` method to the `ElectronAPI` interface after `fetchUsageData`:
    ```typescript
    getCachedUsage: () => Promise<CachedUsageData | null>
    ```

    Do not change any other existing interfaces or exports. Maintain the existing formatting and order.
  </action>
  <verify>Run `npm run typecheck` from /Users/jamesbolton/Documents/GIT/claude-usage-widget — must pass with zero errors.</verify>
  <done>CachedUsageData interface is exported from ipc-types.ts; ElectronAPI includes getCachedUsage returning Promise&lt;CachedUsageData | null&gt;; typecheck passes.</done>
</task>

</tasks>

<verification>
Run `npm run typecheck` — must pass with zero TypeScript errors across both tsconfigs (main and renderer).

Grep check: `grep "GET_CACHED_USAGE" src/shared/ipc-channels.ts` returns 1 match.
Grep check: `grep "CachedUsageData" src/shared/ipc-types.ts` returns at least 2 matches (interface definition + ElectronAPI usage).
</verification>

<success_criteria>
- ipc-channels.ts contains GET_CACHED_USAGE: 'get-cached-usage' in the invoke section
- ipc-types.ts exports CachedUsageData interface with data: UsageData and timestamp: number fields
- ElectronAPI interface includes getCachedUsage: () => Promise&lt;CachedUsageData | null&gt;
- npm run typecheck passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-offline-mode/01-01-SUMMARY.md` following the summary template at @/Users/jamesbolton/.claude/get-shit-done/templates/summary.md
</output>
